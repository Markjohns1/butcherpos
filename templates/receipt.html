{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-5 col-lg-4">
    <!-- Action Buttons -->
    <div class="d-flex justify-content-between align-items-center mb-4 no-print gap-3">
      <a href="{{ url_for('new_sale') }}"
        class="btn btn-outline-secondary d-flex align-items-center gap-2 border-secondary text-muted">
        <i class="fa-solid fa-plus-circle"></i>
        New Sale
      </a>
      <button onclick="window.print()" class="btn btn-danger d-flex align-items-center gap-2 shadow-sm">
        <i class="fa-solid fa-print"></i>
        Print Receipt
      </button>
    </div>

    <!-- Authentic Receipt Container -->
    <div class="receipt-container shadow-lg">
      <div class="receipt-paper p-4">
        <!-- Header -->
        <div class="text-center mb-4">
          <div class="receipt-logo mb-2">
            <i class="fa-solid fa-cloud-meatball fa-2x text-dark"></i>
          </div>
          <h4 class="fw-bold text-uppercase m-0">Prime Cuts</h4>
          <div class="receipt-divider my-2"></div>
          <p class="small mb-0">Premium Butcher Shop</p>
          <p class="small mb-0">123 Market Street, Nairobi</p>
          <p class="small">Tel: +254 700 000 000</p>
        </div>

        <!-- Meta Info -->
        <div class="receipt-meta border-top border-bottom border-secondary border-dashed py-3 mb-4">
          <div class="d-flex justify-content-between mb-1">
            <span class="text-uppercase small fw-bold">Receipt #:</span>
            <span class="font-monospace fw-bold">{{ "%06d"|format(sale.id) }}</span>
          </div>
          <div class="d-flex justify-content-between mb-1">
            <span class="text-uppercase small fw-bold">Date:</span>
            <span class="font-monospace small">{{ sale.sale_datetime[:16].replace('T', ' ') }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="text-uppercase small fw-bold">Cashier:</span>
            <span class="font-monospace small text-uppercase">{{ sale.username }}</span>
          </div>
        </div>

        <!-- Items Table -->
        <div class="receipt-items mb-4">
          <table class="table table-borderless table-sm mb-0">
            <thead class="border-bottom border-dark">
              <tr class="text-uppercase small fw-bold">
                <th class="ps-0 py-2">Item/Description</th>
                <th class="text-center py-2">Qty</th>
                <th class="text-end pe-0 py-2">Total</th>
              </tr>
            </thead>
            <tbody>
              {% for item in items %}
              <tr class="align-middle">
                <td class="ps-0 py-2">
                  <div class="fw-bold">{{ item.name }}</div>
                  <div class="small text-muted">@ {{ "%.2f"|format(item.unit_price) }}</div>
                </td>
                <td class="text-center font-monospace">{{ "%.1f"|format(item.quantity) }}</td>
                <td class="text-end pe-0 font-monospace fw-bold">KES {{ "%.2f"|format(item.line_total) }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Totals Section -->
        <div class="receipt-totals pt-3 border-top border-dark border-2 border-double mb-4">
          <div class="d-flex justify-content-between mb-2 fs-4 fw-bold">
            <span class="text-uppercase">Total Amount</span>
            <span class="font-monospace">KES {{ "%.2f"|format(sale.total_amount) }}</span>
          </div>
          <div class="d-flex justify-content-between text-muted small mb-1">
            <span class="text-uppercase">Payment Method</span>
            <span class="fw-bold">CASH</span>
          </div>
          <div class="d-flex justify-content-between text-muted small">
            <span class="text-uppercase">Items Count</span>
            <span class="fw-bold">{{ items|length }}</span>
          </div>
        </div>

        <!-- Footer -->
        <div class="text-center pt-4 mb-2">
          <p class="mb-1 small fw-bold">*** THANK YOU FOR YOUR BUSINESS ***</p>
          <p class="mb-3 small">Please visit us again!</p>
          <div class="receipt-barcode mx-auto mb-2" style="width: 180px; height: 40px;">
            <div class="barcode-stripes"></div>
          </div>
          <p class="font-monospace small mb-0">{{ "%06d"|format(sale.id) }}{{ sale.sale_datetime[5:7] }}{{
            sale.sale_datetime[8:10] }}</p>
        </div>
      </div>
      <!-- Decorative Zig-Zag Edge -->
      <div class="receipt-zigzag"></div>
    </div>
  </div>
</div>

<style>
  /* Professional POS Receipt Styling */
  .receipt-container {
    background: #e2e2e7;
    padding: 20px;
    border-radius: 4px;
    position: relative;
  }

  .receipt-paper {
    background: #ffffff;
    color: #1a1a1a;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    position: relative;
    max-width: 100%;
    margin: 0 auto;
  }

  .receipt-paper::before,
  .receipt-paper::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    height: 4px;
    background-image: linear-gradient(to right, #ccc 2px, transparent 2px);
    background-size: 4px 1px;
    background-repeat: repeat-x;
  }

  .receipt-paper::before {
    top: 0;
  }

  .receipt-divider {
    height: 1px;
    background: #eee;
    width: 60%;
    margin: 0 auto;
  }

  .font-monospace {
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace !important;
    font-size: 0.85em;
  }

  .border-dashed {
    border-style: dashed !important;
  }

  .border-double {
    border-top-style: double !important;
    border-top-width: 4px !important;
  }

  .receipt-barcode {
    background: #111;
    position: relative;
    overflow: hidden;
  }

  .barcode-stripes {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: repeating-linear-gradient(90deg, #fff, #fff 1px, transparent 1px, transparent 4px, #fff 4px, #fff 5px, transparent 5px, transparent 8px);
    opacity: 0.9;
  }

  .receipt-zigzag {
    height: 12px;
    background: linear-gradient(-45deg, #fff 6px, transparent 0), linear-gradient(45deg, #fff 6px, transparent 0);
    background-position: left bottom;
    background-repeat: repeat-x;
    background-size: 12px 12px;
    filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.05));
  }

  /* Print Settings */
  @media print {
    @page {
      margin: 0;
      size: auto;
    }

    body {
      background: white !important;
      padding: 0 !important;
      margin: 0 !important;
    }

    .no-print {
      display: none !important;
    }

    .main-container,
    .container {
      max-width: 100% !important;
      padding: 0 !important;
      margin: 0 !important;
    }

    .receipt-container {
      padding: 0 !important;
      background: white !important;
      box-shadow: none !important;
      display: flex !important;
      justify-content: center !important;
    }

    .receipt-paper {
      box-shadow: none !important;
      border: 1px solid #f0f0f0;
      width: 80mm !important;
      /* Standard POS width */
      margin: 20px auto !important;
      padding: 10mm !important;
    }

    .receipt-zigzag {
      display: none;
    }
  }
</style>
{% endblock %}